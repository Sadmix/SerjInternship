/* В наших функциях не предусмотрена возможность возврата EOF. Подумайте, что надо
сделать, чтобы можно было возвращать EOF, и скорректируйте соответственно программу. */

#include <stdio.h>

int buf = 0;  // переменная для хранения одного возвращаемого символа или EOF
int buf_full = 0;  // флаг, указывающий на заполненность буфера

/* getch: получить (возможно, возвращенный) символ */
int getch(void) {
    int c;

    if (buf_full) {   // если есть возвращенный символ
        c = buf;
        buf_full = 0;  // очищаем флаг после чтения
    } else {
        c = getchar();  // иначе читаем новый символ
    }

    return c;
}

/* ungetch: вернуть символ в поток */
void ungetch(int c) {
    if (buf_full) {
        printf("ungetch: слишком много символов\n");
    } else {
        buf = c;     // сохраняем символ или EOF для последующего возврата
        buf_full = 1; // устанавливаем флаг, что буфер заполнен
    }
}

int main() {
    int c;

    ungetch('x');  // возвращаем символ 'x'
    c = getch();   // должен вернуть 'x'
    putchar(c);    // печатает 'x'

    ungetch(EOF);  // возвращаем EOF
    c = getch();   // должен вернуть EOF
    if (c == EOF) {
        printf("EOF получен\n");
    }

    return 0;
}